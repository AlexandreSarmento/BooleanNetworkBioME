---
title: "Fundamental Boolean Network"
output:
  github_document: 
    df_print: paged
    html_preview: true
    keep_html: true
  rmarkdown::html_document:
    citation_package: natbib
    fig_caption: true
    theme: null
    lib_dir: libs
#output: rmarkdown::pdf_document
header-includes:
  -  \usepackage{hyperref}
always_allow_html: true
geometry: margin=1in
fontsize: 11pt
spacing: double
endnote: no
graphics: yes
vignette: >
  %\VignetteIndexEntry{P}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
knit: (function(inputFile, encoding) {
  rmarkdown::render(inputFile, encoding = encoding, output_format = "all") })      
---

```{r setup, include = FALSE}
 options(tinytex.verbose = TRUE)
 options(width = 150)
 knitr::opts_chunk$set(
   cache = FALSE,
   message = FALSE,
   warning = FALSE,
   collapse = TRUE,
   comment = "#>",
   fig.width = 12, fig.height = 8
 )     
```
  
```{r error=TRUE, message=FALSE, warning=FALSE, include=FALSE, purl=FALSE, results='hide'}
## This chunk automatically generates a text .R version of this script when running within knitr.
# input  = knitr::current_input()  # filename of input document
# output = paste(tools::file_path_sans_ext(input), 'R', sep = '.')
# try(knitr::purl(input,output,documentation=2,quiet=T), silent = TRUE)
## Avoid duplicate label error of knitr::purl
options(knitr.duplicate.label = 'allow')
## Code to browse the markdown file with renderized images.
knitr::opts_chunk$set(
  fig.path = "figs/FBNNet-"
)
```


# Installing and Loading Libraries            

```{r message=FALSE, warning=FALSE, paged.print=FALSE}
# packages_bioconductor = c("limma")
# 
# #use this function to check if each package is on the local machine
# #if a package is installed, it will be loaded
# #if any are not, the missing package(s) will be installed from Bioconductor and loaded
# package.check <- lapply(packages_bioconductor, FUN = function(x) {
#   if (!require(x, character.only = TRUE)) {
#     BiocManager::install(x, dependencies = TRUE)
#     library(x, character.only = TRUE)
#   }
# })

library(knitr)
library(BoolNet)
library(utils)
library(FBNNet)
library(visNetwork)


packages_cran = c("BoolNet","utils", "visNetwork", "FBNNet","tictoc")
  
#use this function to check if each package is on the local machine
#if a package is installed, it will be loaded
#if any are not, the missing package(s) will be installed from CRAN and loaded
package.check <- lapply(packages_cran, FUN = function(x) {
  if (!require(x, character.only = TRUE)) {
    install.packages(x, dependencies = TRUE)
    library(x, character.only = TRUE)
  }
})

#devtools::install_github("clsdavid/FBNNet2_public")
#devtools::install_github("collectivemedia/tictoc")

rm(package.check, packages_cran)
```


## Introduction
Fundamental Boolean modelling(FBM) has been proposed to draw insights into gene activation, inhibition, and protein decay. This novel Boolean model provides an intuitive definition of activation and inhibition pathways and includes mechanisms to handle protein decay issues. To prove the concept of the novel model, we implemented a platform using R language, called FBNNet. Our experimental results show that the proposed FBM could explicitly display the internal
connections of the mammalian cell cycle between genes separated into the connection
types of activation, inhibition and protein decay.

https://clsdavid.github.io/FBNNet2_public/


## Experiment
The experiments conducted and described here intend to prove the concept of the new Boolean Model, i.e., the FBM. To verify the results, we apply the general processes described in Figure 1 as a benchmark to compare the results generated via BoolNet, with these consequently reconstructed from the new R package, FBNNet.

## Data

```{r, out.width = "100%"}
hif1a.net<-loadNetwork("../data/reduced_HIFaxis.bn")
hif1a.net
```

## Extract the Fundamental Boolean Network

```{r, out.width = "100%"}

tic("Total - Extract FBN")
tic("generateAllCombinationBinary")  
   initialStates <- generateAllCombinationBinary(hif1a.net$genes)
toc()
tic("genereateBoolNetTimeseries") 
   trainingseries <- genereateBoolNetTimeseries(hif1a.net,
                                             initialStates,43,
                                             type = "synchronous")
toc()
tic("generateFBMNetwork") 
FBNcellcyclenetwork <- generateFBMNetwork(timeseries_data = trainingseries,
                                 maxK = 4,
                                 max_deep_temporal = 1,
                                 useParallel = FALSE,
                                 verbose = TRUE)
toc()
toc()

print(FBNcellcyclenetwork)
```


```{r, out.width = "100%"}
   resultfile <- reconstructTimeseries(FBNcellcyclenetwork,
                                    initialStates,
                                    type = "synchronous",
                                    maxTimepoints = 43,
                                    useParallel = FALSE)
   similarreport <- generateSimilaryReport(trainingseries,resultfile)
   print(paste("ErrorRate=",similarreport$ErrorRate,sep = "",collapse = ""))
   print(paste("AccurateRate=",similarreport$AccurateRate,sep = "",collapse = ""))
   print(paste("MissMatchedRate=",similarreport$MissMatchedRate,sep = "",collapse = ""))
   print(paste("PerfectMatchedRate=",similarreport$PerfectMatchedRate,sep = "",collapse = ""))
   #get attractors
   genes <- rownames(trainingseries[[1]])
   attractor <- searchForAttractors(FBNcellcyclenetwork,initialStates,genes)
   print(attractor)
   #display the dynamic trajectory of the attactor 2
   FBNNetwork.Graph.DrawAttractor(FBNcellcyclenetwork,attractor,1)
```

```{r, out.width = "100%"}

FBNNet::FBNNetwork.Graph(FBNcellcyclenetwork)

```